---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# ProtE
One function to analyze them all! The Proteomics Eye (ProtE) establishes an intuitive framework for the univariate analysis of label-free proteomics data. By compiling all necessary data wrangling and processing steps into the same function, ProtE automates all pairwise statistical comparisons for a given categorical variable, returning to the user performance quality metrics, measures to control for Type-I or Type-II errors, and publication-ready visualizations. 

ProtE is currently compatible with data generated by MaxQuant, DIA-NN and Proteome Discoverer.

## How to install: 

Because some package-dependencies (limma, UniProt.ws, missRanger) are inside the BioConductor repository, if they have not already been installed in your environment, use the reporting code to install the package:
```{r, eval=FALSE}
install.packages("devtools")
install.packages("BiocManager")
options(repos = BiocManager::repositories())
devtools::install_github("theomargel/ProtE")
```

Then load its library with:

```{r setup}
library(ProtE)
```

ProtE features 4 functions, each one tailored for a specific use case.

1.  ```maximum_quantum()``` accepts as input the MaxQuant generated file protein_pg.xlsx
2.  ```dianno()``` accepts as input the DIA-NN (or the FragPipe - DIANN) output file protein_pg.xlsx
3.  ```pd_single()``` accepts as input the Proteome Discoverer output file that contains all sample protein intensities/abundances in one table
4.  ```pd_multi()``` accepts as input separate Proteome Discoverer protein intensity files (Ask Mirka for the naming of the PD settings that determine this)

All 4 functions expect the input file(s) to be parsed in the parameter ```excel_file```. 

# How to use functions 1-3
Functions 1-3 require the samples (columns) in the input file to be sorted consecutively (from left to right) based on the categorical variable that are going to be analyzed for. Example of an experiment with a 3-groups categorical variable: first columns = Control samples, middle columns = Treatment samples, last columns = Compound samples.

## Seting up the pointer to the input file path:
Assuming a MaxQuant quantification has been performed, the file protein_pg.xlsx can be fed to ProtE with the following function:
```{r, eval=FALSE}
maximum_quantum <- (excel_file,
                    group_names,
                    samples_per_group,
                    imputation = FALSE,
                    global_filtering = TRUE,
                    sample_relationship = "Independent",
                    threshold_value = 50,
                    normalization = FALSE,
                    parametric= FALSE,
                    significance = "pV")
```
Insert the file path of the protein_pg.xlsx in the ```excel_file``` parameter. To copy-paste the file path in Windows, firstly locate the desired file inside your folders. Hold Shift and right-click the file, then select "Copy as Path" from the context menu. Go to RStudio and click Ctrl+V or right-click to paste the path. It should look like similar to this:
```{r, eval=FALSE}
maximum_quantum <- (excel_file = "C:\Bioprojects\BreastCancer\Proteomics\MaxQuant\protein_pg.xlsx",
                    group_names,
                    samples_per_group,
                    imputation = FALSE,
                    global_filtering = TRUE,
                    sample_relationship = "Independent",
                    threshold_value = 50,
                    normalization = FALSE,
                    parametric= FALSE,
                    significance = "pV")
```
Now add a second ```\```:

```{r, eval=FALSE}
maximum_quantum <- (excel_file = "C:\\Bioprojects\\BreastCancer\\Proteomics\\MaxQuant\\protein_pg.xlsx",
                    group_names,
                    samples_per_group,
                    imputation = FALSE,
                    global_filtering = TRUE,
                    sample_relationship = "Independent",
                    threshold_value = 50,
                    normalization = FALSE,
                    parametric= FALSE,
                    significance = "pV")
```

## Seting up group names and number of samples per group

Group names are defined in the parameter ```group_names``` as a vector. The order of the group names inside the vector has to follow the order of the groups by which the samples (columns) appear consequtively in the input proteomics file (from the left to the right). Same goes for the number of samples of each group, which is defined again as a vector in the parameter ```samples_per_group```:
```
maximum_quantum <- (excel_file = "C:\\Bioprojects\\BreastCancer\\Proteomics\\MaxQuant\\protein_pg.xlsx",
                    group_names = c("Control", "Treatment", "Compound"),
                    samples_per_group = c(10, 12, 9),
                    imputation = FALSE,
                    global_filtering = TRUE,
                    sample_relationship = "Independent",
                    threshold_value = 50,
                    normalization = FALSE,
                    parametric= FALSE,
                    significance = "pV")
```
In the pairwise comparisons, nominators and denominators of the FoldChange (and consequently the sign of Log2FoldChage) are defined based on the order of the group names declared in the parameter ```group_names```. The general notion based on which FoldChange is determined is: NextGroup/PreviousGroup. 
In our example the FoldChange for every pairwise comparison will be set as: Treatment/Control, Compound/Control and Compound/Treatment.


## How to use `pd_multi()`

```pd_multi``` is tailored for the analysis of multiple **Proteome Discoverer** (PD) exports, each one corresponding to a single sample. To be able to use it, the user must save the PD exports to different folders corresponding to the different groups of the variable that is going to be analyzed. The paths to these folders are specified in the parameter ...:

```
pd_multi (excel_file = "C:\\Bioprojects\\BreastCancer\\Proteomics\\PD\\Control",
                       "C:\\Bioprojects\\BreastCancer\\Proteomics\\PD\\Treatment",
                       "C:\\Bioprojects\\BreastCancer\\Proteomics\\PD\\Compound",
                    imputation = FALSE,
                    global_filtering = TRUE,
                    sample_relationship = "Independent",
                    threshold_value = 50,
                    normalization = FALSE,
                    parametric= FALSE,
                    significance = "pV")
```
In the pairwise comparisons, nominators and denominators of the FoldChange (and consequently the sign of Log2FoldChage) are defined based on the order of the declared group folders in the ```pd_multi``` function. Again, the general notion based on which FoldChange is determined, is: NextGroup/PreviousGroup. In our imaginary example the FoldChange for every pairwise comparison will be set as: Treatment/Control, Compound/Control and Compound/Treatment.

## Summary of the ProtE pipeline
All 4 functions streamline the following process, which is reported in more details in the `ProtE Guide` vignette. 

1.	Normalization of proteomic intensity values (excluding DIA-NN files)

2.	Filtering based on the percentage of missing values.

3.	Imputation of missing data to ensure robust downstream analysis.

4.  Description fetching for DIA-NN input files: .pg_matrix.tsv 

Once the data processing is complete, the package performs statistical analysis for every pairwise comparison to identify significant protein abundance differences between experimental groups. The results are automatically exported as Excel files, and a range of visualizations is generated to facilitate QC and interpretation. These include:

•	Principal Component Analysis (PCA) plots for dimensionality reduction and group comparison.

•	Heatmap highlighting significant proteins.

•	Protein rank-abundance  and meanrank-sd scatterplots.

•	Boxplots and violin plots to display data distribution and variability across groups.



## Output Directory

The results from each function are saved in a folder named **ProtE_Analysis**, which is created inside the last directory of the provided file(s).

ProtE creates 3 sub-folders:
• Data_processing, with the files of the resulting data processing
• Statistical_Analysis, with the  results of the statistical tests
• Plots, with all the plots saved in pdf. format



